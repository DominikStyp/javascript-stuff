<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <script type="text/javascript">
            jQuery(function($){
               
               /**
                * Specific router
                * @returns {undefined}
                */
               function MainController(){
                   var OBJ = this;
                   OBJ.about = function(){
                      $("#main").html("<h1>About page</h1");  
                   };
                   OBJ.contact = function(){
                      $("#main").html("<h1>Contact page</h1"); 
                   };
               };
               
               /**
                * Class which invokes specific controller's method,
                * and changes the url in the browser
                * @returns {undefined}
                */
               function PageRouter(){
                   var OBJ = this;
                   var urlChanger = new DynamicUrlChanger();
                   OBJ.controllerPostfix = "Controller";
                   OBJ.routes = {
                       "about": { controller: "Main", method: "about" },
                       "contact": { controller: "Main", method: "contact" }
                   };
                   OBJ.invokeControllerMethod = function(goToUrl){
                      var r = OBJ.routes;
                      for(url in r){
                          if(url === goToUrl){
                              var controller =  r[url].controller + OBJ.controllerPostfix ;
                              var method = r[url].method;
                              // reflection
                              try {
                                var contrInstance = eval("new " + controller + "()");
                                contrInstance[method]();
                              }
                              catch(e){
                                  console.log(e);
                              }
                          }
                      }
                   };
                   OBJ.goTo = function(url, title){
                        urlChanger.goTo(url, title);
                        OBJ.invokeControllerMethod(url);
                   }; 
               }
               /**
                * Changes url in the browser without reloading the page
                * @returns {undefined}
                */
               function DynamicUrlChanger(){
                     var OBJ = this;
                     OBJ.goTo = function(url, title){
                        window.history.pushState(title, title, url); 
                     };
                     OBJ.goBack = function(){
                         window.history.back();
                     };
                     OBJ.goForward = function(){
                         window.history.forward();
                     };
               }
               var router = new PageRouter();
               /**
                * If user clicks the link, page doesn't reload, but URL changes in the browser
                * return false - ensures that browser doesn't follow clicked link
                */
               $("a").click(function(){
                   router.goTo($(this).attr("href"), $(this).attr("title"));
                   return false;
               });
            });
            
            
        </script>
    </head>
    <body>
        <div id="main">
            Here we have dynamic JavaScipt page.<br />
            If you click on the link below, page won't reload, but new content will be displayed.<br />
        </div>
        <a href="about" title="About page">About page link</a>
        <a href="contact" title="Contact page">Contact page link</a>
    </body>
</html>
